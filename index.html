<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SemRosto</title>

<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.hidden{display:none}

#splash{
position:fixed;inset:0;background:#0f0f0f;
display:flex;flex-direction:column;
justify-content:center;align-items:center;z-index:10}

#auth{max-width:400px;margin:80px auto}
input,button,textarea{
width:100%;padding:12px;margin-top:10px;
border-radius:6px;border:none}
button{background:#6d5dfc;color:#fff;cursor:pointer}

#sidebar{
position:fixed;left:0;top:0;bottom:0;
width:60px;background:#000;
display:none;flex-direction:column;align-items:center;padding-top:20px}

#app{margin-left:80px;padding:20px;display:none}
.card{background:#1c1c1c;padding:20px;border-radius:8px;margin-bottom:20px}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
<h1>SemRosto</h1>
<p><b>Goste de quem a pessoa Ã©,<br>nÃ£o de como ela parece.</b></p>
<button onclick="fecharSplash()">Entendi</button>
</div>

<!-- AUTH -->
<div id="auth">
<h2>Entrar</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button onclick="entrar()">Entrar</button>
<button onclick="criar()">Criar conta</button>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
<button onclick="mostrarPerfil()">ðŸ‘¤</button>
<button onclick="mostrarChat()">ðŸ’¬</button>
<button onclick="logout()">ðŸšª</button>
</div>

<!-- APP -->
<div id="app">

<div id="perfil" class="card hidden">
<h3>Meu perfil</h3>
<p id="nivelTxt"></p>
<textarea id="bio" placeholder="Sobre vocÃª"></textarea>
<textarea id="dia" placeholder="Como foi seu dia?"></textarea>
<button onclick="salvarPerfil()">Salvar</button>
</div>

<div id="chat" class="card hidden">
<h3>Chat</h3>
<p id="chatStatus"></p>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getAuth,createUserWithEmailAndPassword,
signInWithEmailAndPassword,onAuthStateChanged,signOut
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import {
getFirestore,doc,setDoc,getDoc,updateDoc,serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const app = initializeApp({
apiKey:"AIzaSyBm7uwLhsmQsCqgwm1SucUBN24-IbkOayM",
authDomain:"semrosto-70293.firebaseapp.com",
projectId:"semrosto-70293"
});

const auth = getAuth(app);
const db = getFirestore(app);
let usuarioAtual = null;
let dadosUsuario = null;

const nivelMinChat = 2;

function nivelPorXP(xp){
if(xp>=100) return 2;
if(xp>=250) return 3;
return 1;
}

window.fecharSplash=()=>splash.style.display="none";

window.criar=async()=>{
const c=await createUserWithEmailAndPassword(auth,email.value,senha.value);
await setDoc(doc(db,"usuarios",c.user.uid),{
xp:20,nivel:1,criadoEm:serverTimestamp()
});
};

window.entrar=()=>signInWithEmailAndPassword(auth,email.value,senha.value);

onAuthStateChanged(auth,async(user)=>{
if(!user){
usuarioAtual=null;
sidebar.style.display="none";
app.style.display="none";
auth.style.display="block";
return;
}

usuarioAtual=user;
auth.style.display="none";
sidebar.style.display="flex";
app.style.display="block";

const ref=doc(db,"usuarios",user.uid);
const snap=await getDoc(ref);
dadosUsuario=snap.data();

nivelTxt.innerText=`NÃ­vel ${dadosUsuario.nivel} â€¢ XP ${dadosUsuario.xp}`;
mostrarPerfil();
});

window.mostrarPerfil=()=>{
if(!usuarioAtual) return;
perfil.classList.remove("hidden");
chat.classList.add("hidden");
};

window.mostrarChat=()=>{
if(!usuarioAtual) return;
perfil.classList.add("hidden");
chat.classList.remove("hidden");

if(dadosUsuario.nivel<nivelMinChat){
chatStatus.innerText=`ðŸ”’ Chat liberado no nÃ­vel ${nivelMinChat}`;
}else{
chatStatus.innerText="âœ… Chat desbloqueado (em breve)";
}
};

window.salvarPerfil=async()=>{
if(!usuarioAtual) return;

dadosUsuario.xp+=10;
dadosUsuario.nivel=nivelPorXP(dadosUsuario.xp);

await updateDoc(doc(db,"usuarios",usuarioAtual.uid),{
bio:bio.value,dia:dia.value,
xp:dadosUsuario.xp,nivel:dadosUsuario.nivel
});

nivelTxt.innerText=`NÃ­vel ${dadosUsuario.nivel} â€¢ XP ${dadosUsuario.xp}`;
};

window.logout=()=>signOut(auth);
</script>

</body>
</html>
