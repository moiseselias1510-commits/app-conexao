<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SemRosto</title>
<style>
body{margin:0;font-family:Arial;background:#0f0f0f;color:#fff}
.hidden{display:none}
button{cursor:pointer}
input,textarea,button{width:100%;padding:12px;margin-top:10px;border-radius:6px;border:none}
textarea{resize:none}
button{background:#6d5dfc;color:#fff}

#splash{position:fixed;inset:0;background:#0f0f0f;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;text-align:center}
#auth{max-width:400px;margin:80px auto}
#sidebar{position:fixed;left:0;top:0;bottom:0;width:60px;background:#000;display:none;flex-direction:column;align-items:center;padding-top:20px}
#sidebar button{width:40px;height:40px;margin-bottom:10px}
#app{margin-left:80px;padding:20px;display:none}
.card{background:#1c1c1c;padding:16px;border-radius:8px;margin-bottom:16px}
.comment{background:#2a2a2a;padding:8px;border-radius:6px;margin-top:6px}
.small{font-size:12px;color:#aaa}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center}
.modal .box{background:#1c1c1c;padding:20px;border-radius:10px;text-align:center;width:300px}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
<h1>SemRosto</h1>
<p><b>Goste de quem a pessoa Ã©,<br>nÃ£o de como ela parece.</b></p>
<button onclick="splash.style.display='none'">Entendi</button>
</div>

<!-- LOGIN -->
<div id="auth">
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button onclick="entrar()">Entrar</button>
<button onclick="criar()">Criar conta</button>
</div>

<!-- MENU -->
<div id="sidebar">
<button onclick="mostrar('feed')">ðŸ“°</button>
<button onclick="mostrar('perfil')">ðŸ‘¤</button>
<button onclick="mostrar('chat')">ðŸ’¬</button>
<button onclick="logout()">ðŸšª</button>
</div>

<!-- APP -->
<div id="app">

<!-- FEED -->
<div id="feed">
<div class="card">
<textarea id="postTexto" placeholder="Como foi seu dia?"></textarea>
<button onclick="postar()">Postar</button>
</div>
<div id="listaFeed"></div>
</div>

<!-- PERFIL -->
<div id="perfil" class="hidden">
<div class="card">
<h3>Seu perfil</h3>
<textarea id="bio" placeholder="Escreva sobre vocÃª"></textarea>
<button onclick="salvarPerfil()">Salvar</button>
</div>
</div>

<!-- CHAT -->
<div id="chat" class="hidden">
<div class="card">
<h3>Conversas</h3>
<p class="small">Liberadas apenas apÃ³s match</p>
<div id="listaChats"></div>
</div>
</div>

</div>

<!-- MATCH -->
<div id="matchModal" class="modal hidden">
<div class="box">
<p>VocÃªs parecem gostar de conversar.</p>
<button onclick="aceitarMatch()">Continuar</button>
<button onclick="fecharMatch()">Agora nÃ£o</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore,collection,addDoc,doc,setDoc,getDoc,onSnapshot,query,orderBy,serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const app=initializeApp({
 apiKey:"AIzaSyBm7uwLhsmQsCqgwm1SucUBN24-IbkOayM",
 authDomain:"semrosto-70293.firebaseapp.com",
 projectId:"semrosto-70293"
});

const auth=getAuth(app);
const db=getFirestore(app);

let user=null;
let possivelMatch=null;

window.criar=()=>createUserWithEmailAndPassword(auth,email.value,senha.value)
.then(c=>setDoc(doc(db,"usuarios",c.user.uid),{bio:""}));

window.entrar=()=>signInWithEmailAndPassword(auth,email.value,senha.value);
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,u=>{
if(!u){
 sidebar.style.display="none";
 app.style.display="none";
 auth.style.display="block";
 return;
}
user=u;
auth.style.display="none";
sidebar.style.display="flex";
app.style.display="block";
mostrar("feed");
carregarPerfil();
carregarFeed();
});

window.mostrar=id=>{
["feed","perfil","chat"].forEach(x=>document.getElementById(x).classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
};

window.postar=()=>addDoc(collection(db,"feed"),{
 texto:postTexto.value,
 uid:user.uid,
 criadoEm:serverTimestamp()
}).then(()=>postTexto.value="");

function carregarFeed(){
onSnapshot(query(collection(db,"feed"),orderBy("criadoEm","desc")),snap=>{
listaFeed.innerHTML="";
snap.forEach(d=>{
const p=d.data();
const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<p>${p.texto}</p>
<textarea id="r-${d.id}" placeholder="Responder"></textarea>
<button onclick="responder('${p.uid}')">Responder</button>`;
listaFeed.appendChild(div);
});
});
}

window.responder=uid=>{
if(uid===user.uid) return;
possivelMatch=uid;
matchModal.classList.remove("hidden");
};

window.aceitarMatch=()=>{
setDoc(doc(db,"matches",user.uid+"_"+possivelMatch),{
 u1:user.uid,
 u2:possivelMatch
});
matchModal.classList.add("hidden");
};

window.fecharMatch=()=>matchModal.classList.add("hidden");

function carregarPerfil(){
getDoc(doc(db,"usuarios",user.uid)).then(d=>{
if(d.exists()) bio.value=d.data().bio;
});
}

window.salvarPerfil=()=>setDoc(doc(db,"usuarios",user.uid),{bio:bio.value});

</script>
</body>
</html>
